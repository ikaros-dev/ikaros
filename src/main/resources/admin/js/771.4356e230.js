"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[771],{10910:function(t,e,i){i.d(e,{Z:function(){return g}});i(68309);var a=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"70%",title:"文件详情",destroyOnClose:!0},scopedSlots:t._u([{key:"footer",fn:function(){return[t._t("extraFooter"),e("a-popconfirm",{attrs:{cancelText:"取消",okText:"确定",title:"你确定要删除该文件？"},on:{confirm:t.handleDelete}},[e("a-button",{attrs:{type:"danger",loading:t.deleting}},[t._v("删除")])],1)]},proxy:!0}],null,!0),model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[e("a-row",{attrs:{gutter:24,type:"flex"}},[e("a-col",{attrs:{lg:15,md:24,sm:24,xl:15,xs:24}},[e("div",{staticClass:"attach-detail-img pb-3"},[t.isImage?e("a",{attrs:{href:t.file.url,target:"_blank"}},[e("img",{staticClass:"file-detail-preview-img",attrs:{src:t.file.url,loading:"lazy"}})]):t.isVideo?e("VideoDPlayer",{attrs:{url:t.file.url}}):t.isVoice?e("audio",{attrs:{controls:"",src:t.file.url}},[t._v(" 您的浏览器不支持这个格式的音频 ")]):e("div",[t._v("此文件不支持预览")])],1)]),e("a-col",{attrs:{lg:9,md:24,sm:24,xl:9,xs:24}},[e("a-list",{attrs:{itemLayout:"horizontal"}},[e("a-list-item",{staticStyle:{"padding-top":"0"}},[e("a-list-item-meta",{attrs:{description:t.file.id}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("文件ID：")])])],1),e("a-list-item",[e("a-list-item-meta",[t.editable?e("template",{slot:"description"},[e("a-input",{ref:"nameInput",on:{blur:t.handleUpdateName,pressEnter:t.handleUpdateName},model:{value:t.file.name,callback:function(e){t.$set(t.file,"name",e)},expression:"file.name"}})],1):e("template",{slot:"description"},[t._v(t._s(t.file.name))]),e("span",{attrs:{slot:"title"},slot:"title"},[t._v(" 文件名： "),e("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:t.handleEditName}},[e("a-icon",{attrs:{type:"edit"}})],1)],1)],2)],1),e("a-list-item",[e("a-list-item-meta",[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("文件类型：")]),e("span",{attrs:{slot:"description"},slot:"description"},[t._v(" "+t._s(t._f("fileTypeText")(t.file.type)))])])],1),e("a-list-item",[e("a-list-item-meta",{attrs:{description:t._f("fileTypePlace")(t.file.place)}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("存储位置：")])])],1),e("a-list-item",[e("a-list-item-meta",[e("template",{slot:"description"},[t._v(" "+t._s(t._f("fileSizeFormat")(t.file.size))+" ")]),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("文件大小：")])],2)],1),e("a-list-item",[e("a-list-item-meta",[e("template",{slot:"description"},[t._v(" "+t._s(t._f("moment")(t.file.createTime))+" ")]),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("上传日期：")])],2)],1)],1)],1)],1)],1)},n=[],l=i(6835),s=i(48534),r=(i(23157),i(30627)),o=function(){var t=this,e=t._self._c;return e("d-player",{ref:"myVideoDPlayer",attrs:{options:t.options}})},c=[],d={name:"VideoDPlayer",props:{pic:{type:String,default:""},url:{type:String,default:""}},computed:{variablyUrl:function(){return"".concat(this.url)}},data:function(){return{options:{container:{},screenshot:!0,preload:"metadata",volume:.7,video:{pic:"",url:""}}}},beforeMount:function(){this.options.video.pic=this.pic,this.options.video.url=this.url},mounted:function(){this.$emit("player",this.$refs.myVideoDPlayer.dp)},watch:{variablyUrl:function(t,e){this.reRanderVideo(t)}},methods:{reRanderVideo:function(t){this.$log.debug("newVideoUrl",t),this.$refs.myVideoDPlayer.dp.pause(),this.$refs.myVideoDPlayer.dp.switchVideo({url:t})}}},u=d,p=i(1001),f=(0,p.Z)(u,o,c,!1,null,"1aca4086",null),m=f.exports,h={name:"FileDetailModal",components:{VideoDPlayer:m},props:{visible:{type:Boolean,default:!0},file:{type:Object,default:function(){return{}}}},data:function(){return{editable:!1,deleting:!1}},computed:{modalVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}},isImage:function(){return!(!this.file||!this.file.type)&&this.file.type.startsWith("IMAGE")},isVideo:function(){return!(!this.file||!this.file.type)&&this.file.type.startsWith("VIDEO")},isVoice:function(){return!(!this.file||!this.file.type)&&this.file.type.startsWith("VOICE")}},methods:{handleDelete:function(){var t=this;return(0,s.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.deleting=!0,e.next=4,(0,r.Jp)(t.file.id);case 4:t.$emit("delete",t.file),t.deleteErrored=!1,t.modalVisible=!1,e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](0),t.$log.error(e.t0),t.deleteErrored=!0;case 13:return e.prev=13,setTimeout((function(){t.deleting=!1}),400),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[0,9,13,16]])})))()},handleEditName:function(){var t=this;this.editable=!this.editable,this.editable&&this.$nextTick((function(){t.$refs.nameInput.focus()}))},handleUpdateName:function(){var t=this;return(0,s.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.file.name){e.next=3;break}return t.$notification["error"]({message:"提示",description:"文件名称不能为空！"}),e.abrupt("return");case 3:return e.prev=3,e.next=6,(0,r.Wd)(t.file.id,t.file.name);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](3),t.$log.error(e.t0);case 11:return e.prev=11,t.editable=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[3,8,11,14]])})))()},handleCopyLink:function(t){var e=this;this.$copyText(t).then((function(t){e.$log.debug("copy",t),e.$message.success("复制成功！")})).catch((function(t){e.$log.debug("copy.err",t),e.$message.error("复制失败！")}))}}},v=h,_=(0,p.Z)(v,a,n,!1,null,"416117c0",null),g=_.exports},9720:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});i(68309);var a=function(){var t=this,e=t._self._c;return e("page-header-wrapper",{attrs:{title:!1}},[e("a-row",{attrs:{gutter:12}},[e("a-col",{attrs:{xs:24,sm:12,md:8,lg:6,xl:6}},[e("img",{staticStyle:{width:"100%","border-radius":"4px"},attrs:{src:t.anime.coverUrl,alt:"anime.title"}})]),e("a-col",{attrs:{xs:24,sm:12,md:16,lg:18,xl:18}},[e("h2",[t._v(t._s(t.anime.title))]),""!==t.anime.titleCn?e("p",[t._v("中文名："+t._s(t.anime.titleCn))]):t._e(),""!==t.anime.platform?e("p",[t._v("平台："+t._s(t.anime.platform))]):t._e(),""!==t.anime.bgmtvId?e("p",[t._v(" 番组计划： "),e("a",{attrs:{href:"https://bgm.tv/subject/"+t.anime.bgmtvId,target:"_blank"}},[t._v(t._s(t.anime.bgmtvId))])]):t._e(),e("p",[t._v("简介："+t._s(t.anime.overview))]),e("div",[e("h2",[t._v("我的订阅状态")]),e("p",[t._v("暂未订阅")])])])],1),e("br"),e("a-row",[e("a-col",{attrs:{span:"24"}},t._l(t.anime.seasons,(function(i){return e("div",{key:i.id},[e("h2",[t._v(" "+t._s(t._f("seasonTypeFilter")(i.type)))]),e("span",[e("strong",[t._v("原始标题")]),t._v(": "+t._s(i.title))]),e("br"),e("span",[e("strong",[t._v("中文标题")]),t._v(": "+t._s(i.titleCn))]),e("br"),e("span",[e("strong",[t._v("当前集数")]),t._v(": "+t._s(i.episodes.length))]),e("br"),e("span",[e("strong",[t._v("季度简介")]),t._v(": "+t._s(i.overview))]),e("br"),e("a-table",{attrs:{bordered:"",columns:t.episodeTableColumns,pagination:!1,"data-source":i.episodes,rowKey:function(t){return t.seq}},scopedSlots:t._u([{key:"airTimeSlot",fn:function(i){return e("span",{},[t._v(" "+t._s(t._f("moment")(i))+" ")])}},{key:"resourceSlot",fn:function(i){return e("span",{},[e("span",i?[e("a-icon",{attrs:{type:"check-circle",theme:"twoTone","two-tone-color":"#52c41a"}}),e("a",{on:{click:function(e){return t.openFileDetailModal(i)}}},[t._v(t._s(i.name))])]:[e("a-icon",{attrs:{type:"close-circle",theme:"twoTone","two-tone-color":"red"}})],1)])}},{key:"operationSlot",fn:function(i,a){return e("span",{},[e("a-button",{attrs:{type:"dashed"},on:{click:function(e){return t.handleSingleMatchingButtonClick(a)}}},[t._v(" 单个匹配 ")])],1)}}],null,!0)},[e("span",{attrs:{slot:"customOperateTitleSlot"},slot:"customOperateTitleSlot"},[e("a-button",{attrs:{type:"dashed"},on:{click:function(e){return t.handleBatchMatchingButtonClick(i.id)}}},[t._v(" 批量匹配 ")])],1)])],1)})),0)],1),e("FileDetailModal",{attrs:{addToPhoto:!0,file:t.file,visible:t.fileDetailVisible},on:{"update:visible":function(e){t.fileDetailVisible=e}}}),e("FileMatchingModal",{key:t.fileMatchingModalKey,attrs:{"receive-episode-id":t.currentEpisodeIdStr,"receive-season-id":t.currentSeasonIdStr,visible:t.fileMatchingModalVisible},on:{"update:visible":function(e){t.fileMatchingModalVisible=e},dataHasUpdated:function(e){return t.reRenderTable(t.anime.id)}}})],1)},n=[],l=(i(41539),i(54747),i(39714),i(30381)),s=i.n(l),r=i(37498),o=i(10910),c=i(72030),d={name:"AnimeDetail",components:{FileDetailModal:o.Z,FileMatchingModal:c.Z},data:function(){return{anime:{},episodes:[],currentEpisodeIdStr:"",currentSeasonIdStr:"",episodeTableColumns:[{title:"序号",dataIndex:"seq",key:"seq"},{title:"标题",dataIndex:"title",key:"title"},{title:"中文标题",dataIndex:"titleCn",key:"titleCn"},{title:"放送时间",dataIndex:"airTime",key:"airTime",scopedSlots:{customRender:"airTimeSlot"}},{title:"资源",dataIndex:"file",key:"file",scopedSlots:{customRender:"resourceSlot"}},{dataIndex:"operate",key:"operate",slots:{title:"customOperateTitleSlot"},scopedSlots:{customRender:"operationSlot"}}],fileDetailVisible:!1,fileMatchingModalVisible:!1,fileMatchingModalKey:0,file:{}}},beforeMount:function(){if(this.$router.currentRoute.params.id){var t=this.$router.currentRoute.params.id;this.getAnimeDtoById(t)}else this.$set(this,"anime",{})},methods:{getAnimeDtoById:function(t){var e=this;(0,r.NC)(t).then((function(t){var i=t.result;i.airTime=s()(i.airTime),e.$set(e,"anime",i)})).catch((function(i){e.$log.error("find animeDTO fail, err: ",i),e.$message.error("查询番剧详情失败, ID="+t)}))},dataTableAdapter:function(t){t.forEach((function(t){t.key=t.id}))},openFileDetailModal:function(t){this.file=t,this.fileDetailVisible=!0},handleSingleMatchingButtonClick:function(t){this.currentEpisodeIdStr=t.id.toString(),this.currentSeasonIdStr="",this.fileMatchingModalVisible=!0,this.fileMatchingModalKey+=1},handleBatchMatchingButtonClick:function(t){this.currentEpisodeIdStr="",this.currentSeasonIdStr=t.toString(),this.fileMatchingModalVisible=!0,this.fileMatchingModalKey+=1},reRenderTable:function(t){this.getAnimeDtoById(t)}}},u=d,p=i(1001),f=(0,p.Z)(u,a,n,!1,null,"440ef949",null),m=f.exports}}]);