# CHANGELOG

更新日志文档，版本顺序从新到旧，最新版本在最前(上)面。

# 0.16.2

## 新特性

- 管理控制台的关于页面右上角添加个复制环境信息的按钮 #691
- 附件页的page和size添加到url参数里

## 问题修复

- Console条目详情页的标签上下挨在一起 #689

# 0.16.1

## 问题修复

- 优化TagOperate的findAll方法入参 #687
- 创建标签时无法找到用户ID导致的错误

# 0.16.0

## 新特性

- Console支持管理和加载全局header和footer配置

## 插件支持

- 添加`MetaOperate`以支持插件调用三方元数据插件条目查询
- 添加`TagOperate`以支持插件对标签的查询和新增
- 出于安全性考虑插件的内部接口移除所有的删除方法

# 0.15.10

## 问题修复

- 修复条目收藏的异常问题 674
- 修复条目移除后未移除对应收藏的问题 674
- 条目更新封面字段时异常移除相关条目封面字段 #675

# 0.15.9

- 支持Prometheus的指标聚合API #676

# 0.15.8

- [X] Console条目详情页剧集看完按钮动态显示 #671
- [X] 条目剧集和附件的批量匹配接口支持三位数，支持中括号内0~999.0的浮点数 #672

# 0.15.7

- 优化附件删除校验逻辑
- 修复批量移除绑定无法移除不存在的附件的附件引用问题
- 附件删除时不校验附件关系

# 0.15.6

## 新特性

- Console附件选择器，如果只有一个结果，自动选中 #663

# 0.15.5

## 新特性

- 剧集分组和条目关系类型均添加OVA和OAD
- Console条目详情页的剧集Tab名加上数量显示

## 优化

- Console条目关系页使用Tab进行显示

## 问题修复

- 修复没有收藏条目时点击标记剧集已看过的异常提示问题
- 修复新增条目关系缺失部分类型如OAD的问题

# 0.15.4

## 新特性

- Console条目详情页剧集过多时分TAB #654
- Console条目详情页其它剧集分组隐藏批量匹配按钮

## 主题

- 修复默认主题剧集序号选择问题

# 0.15.3

## 问题修复

- 修复SQL问题

## 测试案例

- 添加一些测试案例

# 0.15.2

## 新特性

- 字幕匹配事件监听，支持ssa类型的后缀名
- 剧集序号支持小数

# 0.15.1

## 问题修复

- Basic认证成功后没有设置Authentication到SecurityContextHolder，导致收藏接口403异常

# 0.15.0

## 新特性

- 控制台(Console)的邮件设置添加邮件测试按钮并对接服务端邮件测试接口
- 针对音乐模块的基础表支持，歌单对应剧集列表，歌单收藏对接剧集列表收藏

## 优化

- 扩大剧集表的联合唯一Key范围

# 0.14.3

## 新特性

- 添加一些更为细致的权限目标(auth target)
- 用户个人信息更新接口抽取 #636
- console显示用户昵称

# 0.14.2

## 问题修复

- 条目更新乐观锁问题 #631
- 授权的附件接口判断问题 #633

# 0.14.1

## 优化

- 默认主题的js问题修复
- 默认主题的条目详情页添加URL选择的剧集参数
- 默认主题的条目详情页播放逻辑
- 后台任务相关接口优化
- 针对不同尺寸图片的显示优化 #628

## 依赖

- 升级spirngdoc版本到2.5.0

# 0.14.0

## 优化

- 收藏的接口聚合和优化 #617

## 问题修复

- Console的收藏页条目卡片非预期边框和进度条
- 默认主题的ass字幕挂载问题

# 0.13.1

## 优化

- indices api 添加 cover 字段 #607

## 问题修复

- 编辑条目界面多条绑定资源显示不全 #604
- 条目关系查询 API 404 返回格式不是标准 JSON #609
- 条目关系无法正常移除 #608

# 0.13.0

## 新特性

- 引入flyway，底层结构不影响无缝升级
- 更新用户名
- 更细分的授权

## 优化

- 条目页的剧集详情弹框多资源绑定时的预览
- 运行日志按天和大小进行分割 #594
- console 界面标签的输入和检索功能 #596

# 0.12.6

## 问题修复

- 修复剧集附件匹配时，字幕文件匹配不到。
- 修复批量移除绑定失效

# 0.12.5

## 插件

- 丰富条目同步和条目关系插件接口

# 0.12.4

## 优化

- 条目卡片根据剧集匹配进度，呈现不同的样式。 #582

# 0.12.3

## 问题修复

- 条目同步重复拉取的问题

# 0.12.2

## 问题修复

- 条目番组计划平台的收藏进度无法同步 #4
- 条目被移除时，条目的封面附件未被移除
- 小说条目绑定资源提示非视频媒体 #576

## 优化

- 优化开发文档和本地开发配置
- 当条目同步窗口只有一个第三方的时候，自动选择该第三方 #580
- 在条目新增时，检测到剧集没有条目，自动创建个默认的剧集条目 #579
- 当条目没有剧集的时候，批量绑定按钮加个禁用和提示 #578
- 优化条目剧集的附件绑定操作 #577 ，支持文件名更多格式：` 01 ` `[01]` `EP01` `-01-` `_01_`

# 0.12.1

## 新特性
- 添加关于是否展示web端主题的配置开关
- 浏览器记住console的多语言切换选择 #549
- 完善多语言翻译 #548
- 添加匹配移除条目剧集附件绑定 #554
- JWT令牌认证支持 #560
- 后台添加关于页展示应用信息 #552

## 插件

- 插件接口添加条目同步平台相关接口 #557

## 优化

- 条目同步的平台ID输入框最大字符限制提升到了100

## 问题修复

- 主题相关的模板引擎初始化问题
- 视频文件名带有中括号等特殊字符的，sql的like匹配不到字幕
- 条目关联，自己关联自己，成前传，循环引用了 #558

# 0.12.0

## 新特性

- 新增剧集相关服务端接口
  - 根据剧集ID查询剧集元数据
  - 根据剧集ID查询剧集完整信息
  - 根据剧集ID查询当前剧集所引用的所有附件
- 新增附件关系管理功能，目前主要用于手动绑定视频附件和字幕附件。

## 优化

- 条目剧集附件绑定优化，绑定操作从条目详情页移动至具体的剧集详情弹窗 #531
- 日志记录优化，错误级别日志处理#505

## 问题修复

- 启动console，找不到`@runikaros/api-client`和`@runikaros/shared`
  [#527](https://github.com/ikaros-dev/ikaros/issues/527)。
- 修复附件移动时，子附件的`path`属性没有及时更新的问题。
- 修复服务端WebConsole,附件预览视频文件时，类似`xxx.jpsc.ass`无法正常显示是否简体繁体，同时如果再遇到无法识别的情况，在字幕选择列表直接显示比如`jpsc`。

## 安全更新

- 升级console部分依赖，避免CVE.

# 0.11.7

## 问题修复

- 主题加载机制问题 #455

## 新特性

- 新增`StaticEndpoint`支持获取所有字体URL的接口，所有字体放在用户工作目录下的字体目录`statics/fonts`里
- web console 视频预览引入artplayer #520

## 优化

- 静态文件加载逻辑，通过URL访问`/static/**`，支持在下列三种目录加载静态文件：
  1. 用户工作目录下的静态目录`statics`目录下
  2. `ClassPath`的`static`目录下
  3. `ClassPath`的`templates/static`目录下
- 条目收藏形式优化，提交条目收藏时同时提交条目收藏类型 #521

## 主題

- 默认主题的视频播放器切换为`artplayer.js`

## 安全修复

- console crypto-js: [crypto-js PBKDF2 1,000 times weaker than specified in 1993 and 1.3M times weaker than current standard #18](https://github.com/ikaros-dev/ikaros/security/dependabot/18)
- console axios: [Axios Cross-Site Request Forgery Vulnerability #21](https://github.com/ikaros-dev/ikaros/security/dependabot/21)

# 0.11.6

## 新特性

- 标签功能 #429
  - [X] 服务端接口
  - [X] 控制台条目详情页

## 优化

- 条目详情页，给番组集合平台加上对应的条目详情URL前缀
- 列表接口排序优化 #506 指定默认排序规则
  - 附件列表接口，按类型、名称、大小、更新时间依次升序
  - 条目剧集列表接口，按分组降序，序号、放送时间、创建时间依次升序
  - 剧集附件引用列表接口，在根据参数放送时间排序后，按名称、类型、NSFW依次升序

# 0.11.5

## 优化

### 服务端

- 批量匹配条目剧集和附件功能，新增 ` EPXX ` 的格式：[RegexUtils#parseEpisodeSeqByFileName](https://github.com/ikaros-dev/ikaros/blob/eded95b007f7b8290aba27055a00880d2f794f74/api/src/main/java/run/ikaros/api/infra/utils/RegexUtils.java#L243)
- 条目进度更新单独发布事件，不再循环发布剧集完成状态更新事件

### 控制台

- 附件选择器的表格显示附件的路径
- 附件选择器表格列添加可排序
- 条目详情页剧集表格添加可排序

# 0.11.4

## 新特性

- 当收藏条目时，发布条目收藏更新事件，同时广播给插件，该事件有两个动作，收藏和取消收藏
- 当剧集收藏是否完成更新事件发生时，发布剧集收藏进度更新事件，同时广播给插件

## 控制台优化

- 文件详情添加逻辑路径
- 附件管理页单行右键添加 复制简单名称、复制完整名称、复制URL、下载功能
- 附件表格新增逻辑路径属性，用以区别相同文件名称的不同位置文件
- 附件管理页默认的查询条件`nsfw`修改为`false`
- 修复条目同步后的查询条件不匹配问题

# 0.11.3

## 新特性

- 附件选择输入查询名称时，支持添加空格加多个关键词

## 优化

- 点击创建目录按钮时，自动聚焦到输入框

## 问题修复

- 当单个目录内目录页数超过10的时候，目录选择组件无法展示第二页的目录
- 条目管理页条件查询问题
- 附件选择组件当查询条件更新时，没有自动将当前页设置成第一页
- 条目管理页列表卡片展示优化
- 新增条目后跳转条目管理页的查询问题

# 0.11.2

## 新功能

- 视频字幕关系：当类型为剧集的附件引用表新增事件发生时，和剧集资源匹配更新事件发生时，会根据当前附件的名称模糊查询字幕文件，如果存在则新增一条类型为视频字幕的附件关系记录。
- 查询视频附件所有字幕的API端点

## 优化

- 统一返回结果，优化错误提示 #489

## 问题修复

- 右键复制附件名称失效#491
- 附件移动操作失效#490

# 0.11.1

## 问题修复

- 插件无法正常新增附件
- 当没有指定附件ID时无法正常保存附件
- 多次引用同一个封面，会不停地给封面文件名添加前缀
- 剧集的音乐分组DIST无法正常在控制台显示
- 游戏条目绑定了压缩包资源时，剧集详情资源栏目显示异常
- 控制台附件页无法正常输入名称

## 插件

- 番组计划插件升级适配v0.11.1和问题修复
- Jellyfin插件升级适配v0.11.1和问题修复
- 本地导入插件升级适配v0.11.1和问题修复
- 蜜柑计划插件升级适配v0.11.1和问题修复

## 变更

- 控制台全局查询按键更改为`ctrl`+ `/`键

# 0.11.0

## 新特性

- 条目剧集和附件绑定初步支持ACGMN一些格式
- 默认的首页添加四个数据统计卡片

## 优化

- 控制台附件管理页的查询条件和URL的参数同步
- 控制台条目管理页的查询条件和URL的参数同步
- 用户头像更新
- 控制台头像显示
- 附件页查询参数支持中文

## 问题修复

- 上传附件时无法正常上传到指定父目录
- 附件查询条件更新，URL参数未同步更新
- 条目卡片的显示问题
- 删除被引用的附件错误提示不够明显
- 新建条目和更新条目后没有重定向到对应的条目页
- 条目间关系的显示和跳转问题
- 条目关系移除后本地缓存还在的问题

## 变更

- 控制台全局查询按键更改为`/`键


# 0.10.0

## 重构

- 文件和目录统一成附件 #434
- 控制台移除文件和目录相关页面
- 服务端移除文件和目录相关代码

# 0.9.0

## 新特性

- 游戏模块开发 #423
- 文件和目录统一成附件 #434

## 问题修复

- 默认主题样式文件无法加载 #473

# 0.8.0

## 新特性

- 条目相互之间的关系模型及API设计#461
- Console要求能对条目间关系进行维护 #462
- 优化条目查询接口#463

## 问题

- 优化GitHub提问模板 #464

## 持续集成

- 优化CI流程，自动创建Release #465

## 编译

- Fast Jar 打包支持 #454


# 0.7.5

## 新功能

- web端多主题支持 #450
- Console端支持切换语言到英文:

## 国际化

- git仓库README国际化 #436
- 文档站（docs）国际化 #438
- 官网（site）国际化 #443
- 后台管理端（console）国际化 #435

## 优化

- 默认主题simple内容丰富 #451

# 0.7.4

## 问题修复

- 上传的文件大小异常 #420
- 剧集表唯一键配置不正确
- 更新剧集收藏时，没有取到条目ID，导致无法正常插入数据库

# 0.7.0

## 新功能

- 插件的升级功能 #411
- 条目收藏状态和进度 #414

## 问题修复

- 控制台条目页查询类型不能写死为动漫 #412

# 0.6.2

## 优化

- 控制台条目更新后应该回到对应的条目详情页而不是条目列表页 #404

## 问题修复

- 被禁用的插件应该无法正常启动 #403

# 0.6.1

## 问题修复

- 批量匹配出现问题 #405

## 优化

- 系统间歇性卡顿 #406
- 文件表单条文件记录的唯一性判断 #407

# 0.6.0

## 新特性

- 查询剧集和资源关联信息时同时查询字幕 #391
- 删除目录递归删除所有子文件和子目录 #386
- 条目详情页，支持从条目远端更新条目元数据 #387

## 手机客户端

- 重构视频播放组件，引入VLC播放器支持ASS字幕显示。

## 重构

- 条目的剧集需要分组 #389

## 控制台

- 更新条目编辑的操作逻辑

## 优化

- 剧集字幕搜索性能问题 #395
- 条目默认排序按放送时间倒序 #397

# 0.5.5

## 问题修复

- 条目同步表查询结果不唯一
- 邮件没有正常发送和重复发送问题
- 邮件模板变量渲染问题
- 一些校验问题

# 0.5.0

## 优化

- 剧集资源批量匹配，可匹配的类型：1. xxxx[08]xxxx.xxx 2. xxxx 08 xxxx.xxx

## 新特性

- 蜜柑计划插件支持解析订阅RSS半自动追番
- 番剧资源更新邮件通知

# 0.4.5

## 优化

- 服务端初始化系统配置添加远端开启开关
- 服务端内置搜索引擎不构建文件索引
- 控制台根据是否开启远端配置控制是否展示文件推送和拉取操作按钮
- 控制台全局搜索组件去掉文件搜索

# 0.4.4

## 问题修复

- 目录推送和拉取无法正常运行问题
- 本地导入插件在0.4.1~0.4.3的重复导入问题

# 0.4.3

## 问题修复

- 线程阻塞导致任务无法正常进行

# 0.4.2

## 问题修复

- H2数据库的初始化脚本根目录插入ID不正确
- 加解密文件在容器环境下无法正常运行

## 优化

- 控制台文件详情页，双击文件名称可以更新名称
- 控制台目录可以整个推送或拉取

# 0.4.1

## 问题修复

- 批量匹配剧集文件时类型转化异常

# 0.4.0

## 优化

- 控制台目录文件展示、条目更新剧集编辑
- 服务端文件目录表结构优化

# 0.3.2

## 新特性

- 目录的推送和拉取

## 优化

- 目录加载，只加载当前目录下的子目录和文件

# 0.3.1

## 新特性

- 文件系统添加目录功能，可保留导入目录的原始结构

## 插件

- 优化本地导入插件，本地目录导入保留目录结构

# 0.3.0

## 新特性

- 文件系统重构，支持远端推送和拉取、文件分片加密
- 后台任务系统，专门处理文件推送和拉取等重任务
- 条目的所有剧集推送和拉取

## 控制台

- 对接服务端文件远端拉取和推送接口 #357

# 0.2.3

## 问题修复

- 删除插件异常 #343
- Bean不唯一异常 #332

# 0.2.2

## 服务端

- 添加新的Custom的事件监听
- 添加插件的事件广播

## 插件

- jellyfin插件支持生成媒体目录
- 番组计划插件添加代理配置

# 0.2.1

## 控制台

- 条目页面上的拓展点加载

## Web端

- 用thymeleaf构建了简单的条目展示页

## 服务端

- 新增条目优化，给插件提供拓展点。 #329
- 剧集和文件的批量匹配优化。#330
- 插件的自定义配置和信息展示功能完善 #331

## 插件

- 番组计划插件实现从番组计划拉取条目功能
- 本地文件批量导入数据库文件管理 #121

## Bug

- 插件详情页没有找到configmap的时候提示错误信息
- 已经导入的文件第二次启动重复导入
- 插件删除时针对插件的钩子方法调用报空指针
- 同步调用插件阻塞方法导致主线程不可访问

# 0.2.0

## 管理台

- 基于 Vue3 搭建基本骨架
- 加载核心模块(#312)
- 插件展示和启用停止

## 优化

- 较为灵活的底层模型(表)

## 新特性

- 服务端大重构
- 更为灵活的底层数据模型
- 自定义持久化模型
- 自定义持久化模型 CRUD 接口自动生成
- 插件模块支持功能扩展
- 插件模块支持配置自定义持久化模型
- 实现较为简单的文件上传查询和删除接口(大文件暂不支持)
- Subject(条目)的 CRUD 接口实现
- SubjectRelation(条目关系)的 CRUD 接口实现
- 合并 console 项目到主仓库 ikaros
- 调整项目为多模块结构
- 合并 app 和 rfcs 项目到主仓库 ikaros
- 系统配置信息的更新
- 用户信息和密码的更新
- 插件的安装卸载
- 文件的管理如展示上传移除查询等
- 条目剧集的展示和修改
- 后台全局查询条目和文件支持

## 依赖

- 引入 jacoco 统计测试覆盖率
- 从 servlet 切换到 webflux

## 组件

- 在 npm 官方仓库创建前端组件包@runikaros/shared

## 自动化编译

- 引入 codecev 自动进行测试覆盖率计算

## 安全

- 添加安全模块配置，支持默认的表单登录
- 添加最简基于角色的认证逻辑，用户的角色不是 Master 则无法访问 API

# 0.1.1

## Features

- 优化 Qbittorrent 完成后的种子的剧集匹配 #266

## Bugfix

- qbittorrent 配置无法正常更新 #259

## Documentations

- 更新并正式启用 RFC 文档仓库: https://github.com/ikaros-dev/rfcs

# 0.1.0-rc.2

## Features

- 关于老番支持，种子链接添加接口
- 关于老番支持，种子下载完成后，会在应用目录下的 original 目录硬链接原始的文件结构
- 应用启动前硬链接检查 #207
- 重构 Docker 镜像，增加 PUID PGID Umask 环境变量 #233
- 优化数据库表，去除重复的订阅表 #144
- 引入 flyway 规范 SQL 更改 #86
- 较为方便的导入已有的番剧的方式 #221

## Pages

- 种子链接添加页面

## Documentations

- 部署文档不使用默认端口 #208

## Bugfix

- 剧集文件名存在年份时序列匹配失败问题 #136
- original 目录的文件硬链接没有目录的问题
- Springboot3.0 邮件无法正常发送邮件 #215
- 多级目录无法创建服务端文件硬链接 #218
- Dockerfile 镜像，本地编译无法启动 #225
- 新番部分剧集直接跳过匹配了，导致收不到更新通知邮件 #230
- 旧镜像和新镜像的数据文件权限问题 #234
- 文件搜索，当关键词出现特殊符号时无法搜索 #224
- 文件上传未适配的取消接口请求 #91
- 和蜜柑计划不相关的请求 #245

## Dependencies

- 升级 SpringBoot 至 3.0
- 接口文档使用 springdoc-openapi #228

# 0.1.0-rc.1

## Features

- 添加剧集 URL 更新事件，当剧集 URL 字段更新时，给用户发送邮件通知用户番剧更新了
- 添加应用 URL 前缀环境变量
- 媒体目录会生成与剧集同名的已经上传的 ass 字幕文件，jellyfin 可自动识别

## Pages

- 用户信息更新页面，支持用户邮箱更新

## Bugfix

- 解析蜜柑计划 RSS 失败的问题
- 通知邮件无法包含日文内容的问题
- 通知邮件内容无法显示封面 URL 的问题
- 邮件 URL 的斜杠重复，导致无法访问资源 #188
- 邮件剧集文件名称不是视频类型的也进行更新了 #188
- 剧集和文件批量匹配失效 #191
- 特殊的番剧名称生成的媒体目录不正确问题，如 `Cyberpunk: Edgerunners` 生成的媒体目录成了 `_J1OWX~4` 原因是目录名不能有英文冒号

## Improvements

- 优化剧集 URL 更新时通知的代码逻辑，目前在拉取 qbittorrent 已完成下载的文件任务里，创建服务端对应的文件后，当匹配到对应的剧集
  URL 时，会给用户发送通知邮件
- 通知邮件内容，加上剧集 URL 的文件名称

# 0.1.0-beta.2

## Features

- 添加用户更新接口
- 添加用户密码更新接口
- 添加系统通知的邮件方式的配置
- 添加邮件测试接口
- 分离订阅进度和特征资源更新功能
- 添加动漫批量订阅接口

## Pages

- 添加用户设置页，对接服务端用户更新接口和密码更新接口
- 添加了 Ikaros 的 Logo 页面对应的地方
- 添加邮件配置页面和邮件测试页面，并对接服务端
- 移除页面上的特征资源
- 添加针对动漫的批量订阅功能

## Documentations

- 添加了 Ikaros 的 Logo，并更新了 Readme 文档

# 0.1.0-beta.1

## Features

- 添加动漫订阅接口，包括订阅的进度
- 添加动漫花园资源查询接口
- 添加特征资源匹配下载的定时任务

## Improvements

- 给资源查询添加内存缓存集合，降低对动漫花园的无效重复请求

## Bugfix

- 添加根据关键词查询动漫花园资源接口，修复问题：如果通过番组计划的中文查不到资源，则无法正常订阅 #147
- 给剧集服务根据季度 ID 的查询结果添加了按照序号进行排序的逻辑，修复问题：动漫详情页根据剧集序号的表格需要进行排序 #135
- 动漫列表页，选择其它页数后，无法进行更新列表 #152

## Pages

- 完善动漫详情页，并对接服务端
- 对接动漫资源查询接口，完善动漫详情页订阅流程

## Documentations

- 创建微信公众号，更新 readme 文档，添加官方平台汇总和微信公众号信息

<hr>

# 2022.12

- 切换默认数据库为 postgresql

# 2022.11

- 优化数据库表结构
- 初始化 APP 仓库
- 初始化官网仓库
- 番剧管理的接口开发
- 番剧管理的 Web 管理端页面开发
- 系统配置项的接口开发和 Web 管理端页面开发
- Web 管理端大文件分片上传
- 多主题的简单支持
- 初始化默认的最简主题
- Qbittorrent Web Api 部分接口的封装
- 初步的 RSS 解析
- 初步完成半自动追番
- 半自动追番调试和问题修复，初步可用
- 优化设置项，存储到数据库
- 优化第三方客户端的配置及后台页面系统配置管理
- 修复 GitHub 模板 URL 指向不正确的问题
- 系统配置从环境变量和配置文件移至后台管理页面，的情况下的自动追番调试
- 添加音乐模块的 entity 层和 service 层
- 优化媒体目录生成，jellyfin 可直接识别
- 修复后台开启番组计划和蜜柑计划 HTTP 代理不生效的问题
- 使用事件解耦配置更新和 RestTemplate 重载
- 更换证书为 AGPL3.0
- 更新 README.MD 文档
- 优化生成媒体目录逻辑，从应用数据里生成而不是直接从下载好的 torrent 文件生成
- 优化生成媒体目录，添加剧集文件生成，和生成剧集文件名优化
- 添加 Docker 容器部署指导文档
- 优化 Web 端 admin 操作体验 #70
- 修复 Web 端动漫列表错误问题
- Web 端 admin 添加动漫详情页
- 优化 Web 端 admin 剧集单集匹配和批量匹配
- 初步优化 README 文档
- 实现通过 QB 官方文档内 Cookies 认证的方式调用 Qbittorrent Web API

# PR #44

- 番剧管理的相关开发
- 番剧管理的页面及初步对接后端
- 服务端的接口实现以及调整

# old

## Features

- 给 github feature issue 模板添加 PR 输入框
- 调整 github pr 模板内容的顺序
- 实现了文件的简单上传下载
- 实现了数据模型的初步建立
- 实现了剧集的增删改查
